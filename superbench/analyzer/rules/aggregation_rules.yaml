# SuperBench rules
version: v0.5
superbench:
  rules:
    model-benchmarks-FP32:
      statistics:
        - mean
      categories: model:FP32
      metrics:
        - model-benchmarks:.*/.*/fp32_train_throughput
        - gpt_models/.*/fp32_train_throughput
        - lstm_models/pytorch-lstm/fp32_train_throughput
        - bert_models/pytorch-bert-.*/fp32_train_throughput
        - resnet_models/pytorch-resnet\d*/fp32_train_throughput
        - vgg_models/pytorch-vgg\d*/fp32_train_throughput
        - densenet_models/.*/fp32_train_throughput
    model-benchmarks-FP16:
      statistics: mean
      categories: model:FP16
      metrics:
        - model-benchmarks:.*/.*/fp16_train_throughput
        - gpt_models/.*/fp16_train_throughput
        - lstm_models/pytorch-lstm/fp16_train_throughput
        - bert_models/pytorch-bert-.*/fp16_train_throughput
        - resnet_models/pytorch-resnet\d*/fp16_train_throughput
        - vgg_models/pytorch-vgg\d*/fp16_train_throughput
        - densenet_models/.*/fp16_train_throughput
    micro-aggregation:
      statistics: mean
      categories: MICRO
      aggregate: True
      metrics:
        - gemm-flops:*.*/.*ops
        - mem-bw:*.*/.*_bw
        - kernel-launch:*.*/.*_time
        - computation-communication-overlap:*.*/.*_time
        - cublas-function:*.*/.*_time
        - cudnn-function:*.*/.*_time
        - ort-inference/.*_time.*
        - tensorrt-inference/.*_time.*
    micro-nonaggregation:
      statistics: mean
      categories: MICRO
      metrics:
        - nccl-bw:*.*/allreduce_.*_busbw
        - rccl-bw:*.*/allreduce_.*_busbw
        - sharding-matmul:*.*/.*_time
        - matmul:*.*/.*_time
        - gpu-burn/.*
        - cpu-memory-bw-latency/.*_bw
        - cpu-memory-bw-latency/.*_lat
    gpu-copy-bw:
      statistics: mean
      categories: RDMA
      metrics:
        - gpu-copy-bw:perf/.*gpu._to_gpu.*_write_by_.*_bw
      aggregate: gpu-copy-bw:perf/.*gpu(.*)_to_gpu(.*)_write_by_.*_bw
    ib-loopback1:
      statistics: mean
      categories: RDMA
      metrics:
        #- ib-loopback/ib_write_8388608_ib.*_bw
        - ib-loopback/ib_write_.*_ib.*_bw
      aggregate: ib-loopback/ib_write_.*_ib(.*)_bw
    ib-loopback2:
      statistics: mean
      categories: RDMA
      metrics:
        #- ib-loopback/ib_write_8388608_ib.*_bw
        - ib-loopback/ib_write_bw_.*:\d+
      aggregate: True
    disk:
      statistics: mean
      categories: DISK
      aggregate: disk-benchmark/nvme(\d+n1)_.*_iops
      metrics:
        - disk-benchmark/nvme(\d+n1)_.*_iops
