# SuperBench rules
version: v0.5
superbench:
  rules:
    model-train-benchmarks:
      statistics:
        - mean
      categories: model
      metrics:
        - model-benchmarks:.*/.*/.*_train_throughput
        - gpt_models/.*/.*_train_throughput
        - lstm_models/pytorch-lstm/.*_train_throughput
        - bert_models/pytorch-bert-.*/.*_train_throughput
        - resnet_models/pytorch-resnet\d*/.*_train_throughput
        - vgg_models/pytorch-vgg\d*/.*_train_throughput
        - densenet_models/.*/.*_train_throughput
    model-inference-benchmarks:
      statistics:
        - mean
      categories: model
      aggregate: True
      metrics:
        - model-benchmarks:.*/.*/.*_inference_throughput:\d+
    micro-aggregation:
      statistics: mean
      categories: MICRO1
      aggregate: True
      metrics:
        - gemm-flops:*.*/.*ops
        - mem-bw:*.*/.*_bw
        - kernel-launch:*.*/.*_time
        - computation-communication-overlap:*.*/.*_time
        - cublas-function:*.*/.*_time
        - cudnn-function:*.*/.*_time
        - ort-inference/.*_time.*
        - tensorrt-inference/.*_time.*
        - cublaslt-gemm:*.*/.*ops
        - dist-inference/.*step_times.*
    micro-nonaggregation:
      statistics: mean
      categories: MICRO2
      metrics:
        - nccl-bw:*.*/allreduce_.*_busbw
        - rccl-bw:*.*/allreduce_.*_busbw
        - sharding-matmul:*.*/.*_time
        - matmul:*.*/.*_time
        - gpu-burn/.*_pass
        - gpu_burn/.*_abort
        - cpu-memory-bw-latency/.*_bw
        - cpu-memory-bw-latency/.*_lat
    gpu-copy-bw:
      statistics: mean
      categories: DTOH
      metrics:
        - gpu-copy-bw:perf/.*gpu._to_gpu.*_write_by_.*_bw
        #- gpu-copy-bw:perf/gpu.*_to_cpu_by_sm_under_numa.*_bw
      aggregate: gpu-copy-bw:perf/gpu(.*)_to_gpu(.*)_by_.*_bw
    gpu-copy-bw1:
      statistics: mean
      categories: DTOH
      metrics:
        #- gpu-copy-bw:perf/.*gpu._to_gpu.*_write_by_.*_bw
        - gpu-copy-bw:perf/gpu.*_to_cpu_by_sm_under_numa.*_bw
      aggregate: gpu-copy-bw:perf/gpu(.*)_to_cpu_by_sm_under_numa.*_bw
    gpu-copy-bw2:
      statistics: mean
      categories: HTOD
      metrics:
        #- gpu-copy-bw:perf/.*gpu._to_gpu.*_write_by_.*_bw
        - gpu-copy-bw:perf/cpu_to_gpu(.*)_by_sm_under_numa.*_bw
      aggregate: gpu-copy-bw:perf/cpu_to_gpu(.*)_by_sm_under_numa.*_bw
    disk:
      statistics: mean
      categories: DISK
      aggregate: disk-benchmark/nvme(\d+n1)_.*_iops
      metrics:
        - disk-benchmark/nvme(\d+n1)_.*_iops
